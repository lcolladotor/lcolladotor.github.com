###################################################
### chunk number 1: 
###################################################
options(width=40)


###################################################
### chunk number 2:  eval=FALSE
###################################################
## q()


###################################################
### chunk number 3:  eval=FALSE
###################################################
## help( package = "pkgName")


###################################################
### chunk number 4:  eval=FALSE
###################################################
## ?q
## args(q)


###################################################
### chunk number 5: 
###################################################
apropos("session")


###################################################
### chunk number 6: 
###################################################
plot(rnorm(1000, mean = 3.3128, sd = 0.123), runif(1000, -10.74, 231), type="p", lwd=2, col="blue", main="A long customized plot", col.main="red", pch=19, xlab="1000 values (normal dist.)", ylab="1000 values (uniform dist.)")


###################################################
### chunk number 7:  eval=FALSE
###################################################
## install.packages("BiocManager")
## BiocManager::install(c("Rsamtools", "GenomicRanges", "ChIPpeakAnno"))


###################################################
### chunk number 8:  eval=FALSE
###################################################
## help(package = "GenomicRanges")
## browseVignettes( package = "GenomicRanges")


###################################################
### chunk number 9: 
###################################################
library(GenomicRanges)


###################################################
### chunk number 10: 
###################################################
gr <- GRanges( seqnames = Rle(c("chr", "plasmid", "chr"), c(3, 4, 3)), ranges = IRanges( 11:20, end = 91:100, names = toupper(head(letters, 10))), strand = Rle(strand(c("+", "*", "-", "+", "-")), c(2, 1, 3, 3, 1)), score = round(runif(10, 1, 100)), GC = 46:55)


###################################################
### chunk number 11: 
###################################################
gr


###################################################
### chunk number 12: 
###################################################
class(gr)


###################################################
### chunk number 13: 
###################################################
Rle(c("chr", "plasmid", "chr"), c(3, 4, 3))


###################################################
### chunk number 14: 
###################################################
head(letters,2)
toupper(head(letters,2))
IRanges( 11:20, end = 91:100, names = toupper(head(letters, 10)))


###################################################
### chunk number 15: 
###################################################
Rle(strand(c("+", "*", "-", "+", "-")), c(2, 1, 3, 3, 1))


###################################################
### chunk number 16: 
###################################################
round(runif(10, 1, 100))
46:55


###################################################
### chunk number 17: 
###################################################
seqnames(gr)


###################################################
### chunk number 18: 
###################################################
ranges(gr)


###################################################
### chunk number 19: 
###################################################
strand(gr)


###################################################
### chunk number 20: 
###################################################
values(gr)[,"GC"]


###################################################
### chunk number 21: 
###################################################
names(gr)


###################################################
### chunk number 22: 
###################################################
length(gr)


###################################################
### chunk number 23: 
###################################################
seqlengths(gr) <- c(4000000, 100000)


###################################################
### chunk number 24: 
###################################################
width(gr)


###################################################
### chunk number 25: 
###################################################
split(gr)
split(gr)[[9]]


###################################################
### chunk number 26: 
###################################################
gr[1:2]


###################################################
### chunk number 27: 
###################################################
rev(gr[1])


###################################################
### chunk number 28: 
###################################################
flank(gr, 10)[1:2]


###################################################
### chunk number 29: 
###################################################
shift(gr, 5)[1:2]


###################################################
### chunk number 30: 
###################################################
resize(gr, 1)[1:2]


###################################################
### chunk number 31: 
###################################################
reduce(gr)


###################################################
### chunk number 32: 
###################################################
gaps(gr)[1:2]


###################################################
### chunk number 33: 
###################################################
coverage(gr)


###################################################
### chunk number 34: 
###################################################
library(Rsamtools)
which <- RangesList(seq1 = IRanges(1000, 2000), seq2 = IRanges(c(100, 1000), c(1000, 2000)))
what <- c("rname", "strand", "pos", "qwidth", "seq")
param <- ScanBamParam(which = which, what = what)


###################################################
### chunk number 35: 
###################################################
which
bamFile <- system.file("extdata", "ex1.bam", package="Rsamtools")


###################################################
### chunk number 36: 
###################################################
bam <- scanBam(bamFile, param=param)


###################################################
### chunk number 37: 
###################################################
class(bam)
names(bam)


###################################################
### chunk number 38: 
###################################################
class(bam[[1]])
names(bam[[1]])


###################################################
### chunk number 39: 
###################################################
sapply(bam[[1]], class)


###################################################
### chunk number 40: 
###################################################
lst <- lapply(names(bam[[1]]), function(elt) {
  do.call(c, unname(lapply(bam, "[[", elt)))
})
names(lst) <- names(bam[[1]])
df <- do.call("DataFrame", lst)
head(df, 2)


###################################################
### chunk number 41:  eval=FALSE
###################################################
## which <- GRanges(seqnames = "6", ranges = IRanges(1e+05, 110000))
## param <- ScanBamParam(which = which)
## na19240bam <- scanBam(na19240url, param = param)


###################################################
### chunk number 42: 
###################################################
library(ChIPpeakAnno)
data(myPeakList)
data(TSS.human.GRCh37)
head(myPeakList,2)
head(TSS.human.GRCh37, 2)


###################################################
### chunk number 43: 
###################################################
annotatedPeak = annotatePeakInBatch (myPeakList[1:6,], AnnotationData = TSS.human.GRCh37)
head(annotatedPeak,2)


###################################################
### chunk number 44:  eval=FALSE
###################################################
## write.table(as.data.frame(annotatedPeak), file="annotatedPeakList.xls", sep="\t", row.names=FALSE)


###################################################
### chunk number 45: 
###################################################
y = annotatedPeak$distancetoFeature[!is.na(annotatedPeak$distancetoFeature) & annotatedPeak$fromOverlappingOrNearest == "NearestStart"]
hist(y, xlab="Distance To Nearest TSS", main="", breaks=1000, xlim=c(min(y)-100, max(y)+100))


###################################################
### chunk number 46: 
###################################################
temp = as.data.frame(annotatedPeak)
pie(table(temp[as.character(temp$fromOverlappingOrNearest) == "Overlapping" | (as.character(temp$fromOverlappingOrNearest) == "NearestStart" & !temp$peak %in% temp[as.character(temp$fromOverlappingOrNearest) == "Overlapping", ]$peak) ,]$insideFeature))


###################################################
### chunk number 47: 
###################################################
data(Peaks.Ste12.Replicate1)
data(Peaks.Ste12.Replicate2)
data(Peaks.Ste12.Replicate3)
head(Peaks.Ste12.Replicate1, 2)


###################################################
### chunk number 48: 
###################################################
makeVennDiagram(RangedDataList(Peaks.Ste12.Replicate1, Peaks.Ste12.Replicate2, Peaks.Ste12.Replicate3), NameOfPeaks = c("Replicate1","Replicate2","Replicate3"), maxgap = 0,totalTest = 1580)


###################################################
### chunk number 49: 
###################################################
sessionInfo()


